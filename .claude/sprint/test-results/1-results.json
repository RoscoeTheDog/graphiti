{
  "story_id": "1",
  "phase": "testing",
  "executed_by": "testing:1.t",
  "timestamp": "2025-12-14T22:00:00Z",

  "summary": {
    "total_tests": 34,
    "passed": 15,
    "failed": 19,
    "skipped": 0,
    "pass_rate": 44,
    "duration_ms": 890
  },

  "categories": {
    "unit": {
      "total": 21,
      "passed": 13,
      "failed": 8,
      "coverage": null
    },
    "integration": {
      "total": 11,
      "passed": 2,
      "failed": 9,
      "coverage": null
    },
    "security": {
      "total": 2,
      "passed": 0,
      "failed": 2,
      "vulnerabilities": []
    }
  },

  "failures": [
    {
      "test": "test_validate_python_version_rejects_3_9",
      "category": "unit",
      "error": "AssertionError: Implementation raises exception instead of returning False",
      "file": "tests/daemon/test_venv_manager.py:64",
      "severity": "medium"
    },
    {
      "test": "test_validate_python_version_rejects_3_8",
      "category": "unit",
      "error": "AssertionError: Implementation raises exception instead of returning False",
      "file": "tests/daemon/test_venv_manager.py:70",
      "severity": "medium"
    },
    {
      "test": "test_validate_python_version_rejects_2_7",
      "category": "unit",
      "error": "AssertionError: Implementation raises exception instead of returning False",
      "file": "tests/daemon/test_venv_manager.py:76",
      "severity": "medium"
    },
    {
      "test": "test_detect_venv_returns_false_for_corrupted_venv",
      "category": "unit",
      "error": "AssertionError: Mock setup incorrect - needs pyvenv.cfg check",
      "file": "tests/daemon/test_venv_manager.py:125",
      "severity": "medium"
    },
    {
      "test": "test_create_venv_uses_uv_when_available",
      "category": "unit",
      "error": "VenvCreationError: create_venv() returns tuple, mock validation incomplete",
      "file": "tests/daemon/test_venv_manager.py:145",
      "severity": "high"
    },
    {
      "test": "test_create_venv_falls_back_to_python_when_uv_unavailable",
      "category": "unit",
      "error": "VenvCreationError: create_venv() returns tuple, mock validation incomplete",
      "file": "tests/daemon/test_venv_manager.py:168",
      "severity": "high"
    },
    {
      "test": "test_create_venv_is_idempotent_skips_if_exists",
      "category": "unit",
      "error": "AssertionError: Expected bool but got tuple (success, message)",
      "file": "tests/daemon/test_venv_manager.py:189",
      "severity": "high"
    },
    {
      "test": "test_create_venv_handles_subprocess_failure",
      "category": "unit",
      "error": "VenvCreationError: Expected bool return, but raises exception",
      "file": "tests/daemon/test_venv_manager.py:261",
      "severity": "medium"
    },
    {
      "test": "test_daemon_install_creates_venv",
      "category": "integration",
      "error": "TypeError: cannot unpack non-iterable bool object - DaemonManager expects tuple from create_venv()",
      "file": "tests/daemon/test_venv_integration.py:42",
      "severity": "high"
    },
    {
      "test": "test_daemon_install_skips_venv_if_exists",
      "category": "integration",
      "error": "TypeError: cannot unpack non-iterable bool object",
      "file": "tests/daemon/test_venv_integration.py:65",
      "severity": "high"
    },
    {
      "test": "test_daemon_install_fails_with_old_python",
      "category": "integration",
      "error": "ValueError: not enough values to unpack (expected 2, got 0)",
      "file": "tests/daemon/test_venv_integration.py:83",
      "severity": "high"
    },
    {
      "test": "test_daemon_install_with_uv_available",
      "category": "integration",
      "error": "TypeError: cannot unpack non-iterable bool object",
      "file": "tests/daemon/test_venv_integration.py:110",
      "severity": "high"
    },
    {
      "test": "test_daemon_install_without_uv_fallback",
      "category": "integration",
      "error": "TypeError: cannot unpack non-iterable bool object",
      "file": "tests/daemon/test_venv_integration.py:132",
      "severity": "high"
    },
    {
      "test": "test_daemon_status_shows_venv_exists",
      "category": "integration",
      "error": "TypeError: status() returns None (prints instead of returning dict)",
      "file": "tests/daemon/test_venv_integration.py:162",
      "severity": "high"
    },
    {
      "test": "test_daemon_status_shows_venv_missing",
      "category": "integration",
      "error": "TypeError: status() returns None",
      "file": "tests/daemon/test_venv_integration.py:185",
      "severity": "high"
    },
    {
      "test": "test_daemon_status_shows_venv_invalid",
      "category": "integration",
      "error": "AttributeError: Cannot mock Path.exists (read-only)",
      "file": "tests/daemon/test_venv_integration.py:200",
      "severity": "medium"
    },
    {
      "test": "test_bootstrap_validates_venv_exists",
      "category": "integration",
      "error": "ImportError: validate_environment() function not implemented in bootstrap.py",
      "file": "tests/daemon/test_venv_integration.py:220",
      "severity": "high"
    },
    {
      "test": "test_bootstrap_warns_if_venv_missing",
      "category": "integration",
      "error": "ImportError: validate_environment() not implemented",
      "file": "tests/daemon/test_venv_integration.py:241",
      "severity": "high"
    },
    {
      "test": "test_subprocess_commands_properly_escaped",
      "category": "security",
      "error": "VenvCreationError: Mock validation incomplete",
      "file": "tests/daemon/test_venv_integration.py:287",
      "severity": "high"
    }
  ],

  "acceptance_criteria_coverage": {
    "AC-1.1": {
      "covered": false,
      "tests": ["test_daemon_install_creates_venv", "test_daemon_install_skips_venv_if_exists"],
      "reason": "Integration tests failing - DaemonManager expects tuple return from create_venv()"
    },
    "AC-1.2": {
      "covered": false,
      "tests": ["test_check_uv_available_when_uv_in_path", "test_check_uv_available_when_uv_not_available", "test_create_venv_uses_uv_when_available", "test_create_venv_falls_back_to_python_when_uv_unavailable"],
      "reason": "Unit tests for uv detection passing, but create_venv tests failing due to mock issues"
    },
    "AC-1.3": {
      "covered": false,
      "tests": ["test_detect_venv_returns_true_for_existing_valid_venv", "test_detect_venv_returns_false_for_nonexistent_venv", "test_create_venv_is_idempotent_skips_if_exists"],
      "reason": "Idempotency test failing - expected bool but got tuple"
    },
    "AC-1.4": {
      "covered": true,
      "tests": ["test_validate_python_version_accepts_3_10", "test_validate_python_version_accepts_3_11", "test_validate_python_version_accepts_3_12"],
      "reason": "Accepts valid Python versions correctly, but rejection tests expect exceptions not bool"
    }
  },

  "recommendations": [
    {
      "type": "fix_required",
      "description": "Update tests to match create_venv() tuple return signature",
      "action": "Fix all tests expecting bool from create_venv() to expect (bool, str) tuple"
    },
    {
      "type": "fix_required",
      "description": "Update tests to expect exceptions for invalid Python versions",
      "action": "Use pytest.raises(IncompatiblePythonVersionError) for version rejection tests"
    },
    {
      "type": "fix_required",
      "description": "Fix mock setup for detect_venv() corrupted venv test",
      "action": "Add pyvenv.cfg check to mock setup"
    },
    {
      "type": "fix_required",
      "description": "Fix DaemonManager.status() return value",
      "action": "Update integration tests to handle None return (prints instead of returns dict)"
    },
    {
      "type": "fix_required",
      "description": "Implement validate_environment() in bootstrap.py",
      "action": "Add venv validation function to bootstrap module (from plan requirements)"
    },
    {
      "type": "improve",
      "description": "Add more comprehensive mocking for subprocess validation",
      "action": "Mock both subprocess execution AND detect_venv() validation in create_venv tests"
    }
  ],

  "threshold_check": {
    "blocking_threshold": 90,
    "result": "below_threshold",
    "action": "block_and_recommend_remediation"
  },

  "outcome": "blocked",
  "blocking": true
}
