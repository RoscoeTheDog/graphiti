# Story 2.3: Configurable Filtering System (PLANNED - NOT IMPLEMENTED)
**Status**: blocked
**Parent**: Story 2
**Created**: 2025-11-17 00:05
**Blocked By**: Configuration architecture issues (Stories 2.3.1, 2.3.2, 2.3.3)
**Updated**: 2025-11-17 16:30
**Claimed**: 2025-11-18 11:56
**Completed**: 2025-11-18 12:08

## Current State vs Planned

### ❌ What Was Planned (NOT IMPLEMENTED)
Add configurable filtering rules for opt-in/opt-out per message type with multiple content modes (full/omit/summary).

### ✅ What Actually Exists
**File**: `graphiti_core/session_tracking/filter.py`
- Hardcoded filtering behavior (no configuration)
- Single boolean flag: `preserve_tool_results`
- Behavior matches Story 2.3 defaults but NOT configurable:
  - User messages: full (hardcoded line 140)
  - Agent messages: full (hardcoded line 144)
  - Tool calls: structure kept, results summarized (hardcoded lines 149-152)
- 1-line tool result summaries (hardcoded logic lines 189-234)
- No per-message-type configuration
- No ContentMode options

### ❌ What's Missing (0% Implemented)
1. **FilterConfig dataclass** - File doesn't exist
2. **ContentMode enum** - Not in codebase
3. **Configuration integration** - No integration with unified_config.py or graphiti.config.json
4. **Configurable filtering** - SessionFilter uses hardcoded logic only
5. **LLM summarization for ContentMode.SUMMARY** - Not implemented (only hardcoded 1-line summaries)
6. **Test file** - `tests/session_tracking/test_filter_config.py` doesn't exist
7. **Documentation** - CONFIGURATION.md has no filtering configuration section

## Blocking Issues

This story is blocked by fundamental configuration architecture problems:

1. **Story 2.3.1**: Config paths use `~/.claude/` (should be `~/.graphiti/` for MCP server independence)
2. **Story 2.3.2**: Schema mismatches between `graphiti.config.json` and `SessionTrackingConfig`
3. **Story 2.3.3**: No config validator (can't verify configs load correctly)

**Decision**: Fix configuration foundation (2.3.1, 2.3.2, 2.3.3) BEFORE implementing configurable filtering.

## Revised Acceptance Criteria

### Prerequisites (must complete first)
- [ ] Story 2.3.1 completed (config architecture fixed)
- [ ] Story 2.3.2 completed (schema mismatches resolved)
- [ ] Story 2.3.3 completed (config validator implemented)

### Implementation (after prerequisites)
- [ ] FilterConfig dataclass created with per-type settings:
  - [ ] `tool_calls: bool` - Track tool call structure (default: true)
  - [ ] `tool_content: ContentMode` - Tool result content mode (default: "summary")
  - [ ] `user_messages: ContentMode` - User message content mode (default: "full")
  - [ ] `agent_messages: ContentMode` - Agent message content mode (default: "full")
  - [ ] ContentMode enum: "full" | "omit" | "summary"
- [ ] Configuration integrated into SessionTrackingConfig in unified_config.py
- [ ] SessionFilter.filter_messages() updated to use configuration
- [ ] Summarizer class integration for ContentMode.SUMMARY (reuse existing summarizer.py)
- [ ] Unit tests for all configuration combinations (9+ test scenarios)
- [ ] Documentation: CONFIGURATION.md updated with filtering options
- [ ] **Cross-cutting requirements satisfied** (see CROSS_CUTTING_REQUIREMENTS.md):
  - [ ] Type hints and Pydantic models for configuration
  - [ ] Error handling with logging (invalid config)
  - [ ] >80% test coverage
  - [ ] Configuration uses unified system
  - [ ] Documentation updated

## Implementation Notes
- Current filter.py behavior is CORRECT for default config but NOT configurable
- Default configuration maintains current behavior (user/agent full, tool content summarized)
- Backward compatible design (preserve_tool_results flag remains for compatibility)
- LLM summarization reuses existing summarizer.py (don't create new one)

