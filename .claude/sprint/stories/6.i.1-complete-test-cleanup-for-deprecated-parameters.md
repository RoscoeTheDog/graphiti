# Story 6.i.1: Complete Test Cleanup for Deprecated Parameters

**Parent**: Story 6.i
**Issue**: test_coverage_gap - Incomplete cleanup of test files referencing deprecated parameters
**Created**: 2025-12-12 (Validation -6.i)
**Priority**: P1
**Status**: unassigned

## Analysis

**Validation Finding**: Story 6.i was marked complete, but validation check discovered test files still reference deprecated parameters (`inactivity_timeout`, `check_interval`) that were removed in Story 2.

**Affected Test Files**:
1. `tests/mcp/test_session_tracking_tools.py` - Lines 40-41 (and potentially more)
2. `tests/session_tracking/test_performance.py` - Lines 96-97, 108-109, 143-144

**Root Cause**: Story 6 implementation (commit c0a9966) successfully removed several test files and cleaned up `test_config_validator.py`, but did not update all test files that instantiate `SessionManager` with the deprecated constructor parameters.

**Codebase Context**:
- Session Manager was modified in Story 2 to remove time-based parameters
- The `inactivity_timeout` and `check_interval` parameters are no longer supported
- Test files from the MCP tools module (`tests/mcp/`) were not part of the original Story 6 scope
- Performance tests (`tests/session_tracking/test_performance.py`) were partially cleaned but not fully

## Remediation Actions

### 1. Clean up `tests/mcp/test_session_tracking_tools.py`

**Location**: Lines 38-41 (and scan for other occurrences)

**Current Code**:
```python
mock_config = Mock()
mock_config.session_tracking.enabled = True
mock_config.session_tracking.watch_path = "/test/path"
mock_config.session_tracking.inactivity_timeout = 300  # REMOVE
mock_config.session_tracking.check_interval = 60       # REMOVE
```

**Action Required**:
- Remove lines setting `inactivity_timeout` and `check_interval`
- Search entire file for all occurrences of these deprecated fields
- Update any assertions that check for these fields in status results
- Verify mock objects no longer reference deprecated configuration

**Search Pattern**:
```bash
grep -n "inactivity_timeout\|check_interval" tests/mcp/test_session_tracking_tools.py
```

**Expected Changes**: 10-15 lines removed/modified

### 2. Clean up `tests/session_tracking/test_performance.py`

**Location**: Lines 94-98, 106-110, 141-145

**Current Code** (example from line 94):
```python
manager = SessionManager(
    path_resolver=path_resolver,
    inactivity_timeout=300,  # REMOVE
    check_interval=60,       # REMOVE
    keep_length_days=7
)
```

**Action Required**:
- Remove `inactivity_timeout` and `check_interval` parameters from all `SessionManager` constructor calls
- Verify `SessionManager` initialization works with only remaining valid parameters:
  - `path_resolver` (required)
  - `keep_length_days` (optional)
- Update any performance assertions that depend on these removed parameters
- Check if any test logic needs adjustment (e.g., tests that measured periodic checking overhead)

**Expected Changes**: 6-8 lines removed across 3 test methods

### 3. Verify SessionManager Constructor Signature

**Reference**: Check `graphiti_core/session_tracking/session_manager.py` to confirm current constructor parameters.

**Expected Signature** (post-Story 2):
```python
def __init__(
    self,
    path_resolver: ClaudePathResolver,
    keep_length_days: int | None = None
):
    """
    Initialize SessionManager.

    Args:
        path_resolver: Path resolver for session directories
        keep_length_days: Optional filter for old sessions (default: None = all sessions)
    """
```

### 4. Run Tests and Verify

After making changes:

```bash
# Run affected test files
pytest tests/mcp/test_session_tracking_tools.py -v
pytest tests/session_tracking/test_performance.py -v

# Verify no deprecated parameter references remain
grep -r "inactivity_timeout\|check_interval" tests/ --include="*.py" | grep -v ".log" | grep -v "htmlcov"

# Run full test suite to ensure no regressions
pytest tests/ -v
```

**Expected Test Results**:
- All tests pass
- No references to `inactivity_timeout` or `check_interval` in test code (documentation references in comments are acceptable)
- Test coverage maintained or improved

## Acceptance Criteria

- [ ] (P0) Remove `inactivity_timeout` and `check_interval` from `tests/mcp/test_session_tracking_tools.py`
- [ ] (P0) Remove `inactivity_timeout` and `check_interval` from `tests/session_tracking/test_performance.py`
- [ ] (P1) Verify no other test files reference these deprecated parameters (full grep search)
- [ ] (P1) All affected tests pass after cleanup
- [ ] (P2) Test coverage remains â‰¥ 80% for session tracking modules

## Dependencies

- Story 6.i (parent - completed but incomplete)
- Story 2 (SessionManager refactoring - completed)

## Related Stories

- Story 2: Remove Session Manager Time-Based Logic
- Story 6: Clean Up Test Files
- Story -6.i: Validation Implementation for Story 6

## Notes

**Why This Matters**:
- Tests that reference deprecated parameters create technical debt
- May cause confusion for developers who see references to removed features
- Can break if SessionManager is further refactored (e.g., if deprecated parameters are completely removed from type hints)
- Ensures consistency between implementation and test code

**Blocking**: This story blocks siblings in the remediation chain to ensure test cleanup is complete before validation can pass.
