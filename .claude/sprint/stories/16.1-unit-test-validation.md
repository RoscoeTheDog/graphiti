# Story 16.1: Unit Test Validation

**Status**: unassigned
**Parent**: Story 16
**Created**: 2025-11-18 23:30
**Priority**: CRITICAL
**Estimated Effort**: 4 hours
**Phase**: 8.1 (Week 3, Day 5)
**Depends on**: Stories 9-15

## Description

Implement comprehensive unit tests for all new session tracking features introduced in Stories 9-15. Focus on isolated component testing with >80% coverage target.

**Scope**:
- Periodic checker lifecycle tests
- Template resolution hierarchy tests
- Filter value resolution tests
- Time-based filtering (keep_length_days)
- Configuration auto-generation tests

## Acceptance Criteria

### Periodic Checker Tests
- [ ] Test periodic checker starts correctly
- [ ] Test periodic checker runs at configured interval
- [ ] Test periodic checker cancels gracefully
- [ ] Test session closes after inactivity_timeout + check latency
- [ ] Test multiple sessions close independently

**File**: `tests/session_tracking/test_periodic_checker.py`

### Template System Tests
- [ ] Test template resolution hierarchy (project > global > built-in > inline)
- [ ] Test project templates override global
- [ ] Test global templates used when no project template
- [ ] Test built-in templates used as fallback
- [ ] Test inline prompts detected correctly

**File**: `tests/session_tracking/test_template_system.py`

### Filter Configuration Tests
- [ ] Test `bool | str` type system (True, False, "path/to/template.md")
- [ ] Test filter value resolution logic
- [ ] Test configuration validation (reject invalid types)

**File**: `tests/session_tracking/test_filter_config.py` (update existing)

### Rolling Period Filter Tests
- [ ] Test sessions older than keep_length_days filtered
- [ ] Test sessions within window discovered
- [ ] Test null keep_length_days discovers all sessions
- [ ] Test time comparison logic (file mtime)

**File**: `tests/session_tracking/test_rolling_filter.py`

### Configuration Auto-Generation Tests
- [ ] Test config auto-generated on first run
- [ ] Test existing config NOT overwritten
- [ ] Test config structure valid (all required fields)
- [ ] Test default values correct (enabled=false, auto_summarize=false, keep_length_days=7)

**File**: `tests/test_config_generation.py`

### Coverage Requirements
- [ ] All unit tests pass (>95% pass rate)
- [ ] Test coverage >80% for new code
- [ ] All edge cases covered

## Implementation Details

See Story 16 (parent) for detailed test code examples.

### Key Test Files to Create
1. `tests/session_tracking/test_periodic_checker.py` (~150 LOC)
2. `tests/session_tracking/test_template_system.py` (~200 LOC)
3. `tests/session_tracking/test_rolling_filter.py` (~150 LOC)
4. `tests/test_config_generation.py` (~100 LOC)

### Test Count
- **Total new tests**: ~25 unit tests
- **Estimated runtime**: <30 seconds (all unit tests)

## Dependencies

- Story 9 (Periodic Checker Implementation) - REQUIRED
- Story 10 (Configuration Schema Changes) - REQUIRED
- Story 11 (Template System) - REQUIRED
- Story 12 (Rolling Period Filter) - REQUIRED
- Story 14 (Config Auto-Generation) - REQUIRED

## Cross-Cutting Requirements

See parent sprint `.claude/implementation/CROSS_CUTTING_REQUIREMENTS.md`:
- Testing: >80% coverage
- Platform-specific tests: Windows + Unix
- Error handling: Comprehensive test coverage
- Type safety: All test code type-annotated
