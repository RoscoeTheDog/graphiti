# Plan: 13
# Generated by: discovery:13.d
# Timestamp: 2025-12-11T22:30:00Z

story_id: "13"
title: "Template Updates"
created: "2025-12-11T22:30:00Z"
created_by: "discovery:13.d"

# Analysis Summary
analysis:
  summary: "Update existing message summarization templates with explicit length constraints and create new session-level template with activity-aware dynamic extraction instructions"
  complexity: "low"
  estimated_files: 4
  estimated_tokens: 3000
  risk_factors:
    - "Templates are used by existing code - need to ensure backward compatibility"
    - "New session summary template needs to align with existing prompt_builder.py dynamic prompt generation"

# Files to Create
files_to_create:
  - path: "graphiti_core/session_tracking/prompts/default-session-summary.md"
    purpose: "New template for full session summarization with activity profile and dynamic extraction placeholders"
    pattern_source: "graphiti_core/session_tracking/prompt_builder.py (DEFAULT_PROMPT_TEMPLATE)"
    estimated_lines: 20

# Files to Modify
files_to_modify:
  - path: "graphiti_core/session_tracking/prompts/default-user-messages.md"
    changes:
      - "Change '1-2 sentences' to '1 paragraph or less' for explicit length constraint"
      - "Update final instruction text to match new wording"
    lines_affected: 2

  - path: "graphiti_core/session_tracking/prompts/default-agent-messages.md"
    changes:
      - "Add 'or less' qualifier to '1 paragraph' for explicit length constraint"
      - "Update final instruction text to match new wording"
    lines_affected: 2

  - path: "graphiti_core/session_tracking/prompts.py"
    changes:
      - "Update DEFAULT_USER_MESSAGES_TEMPLATE constant to match .md file"
      - "Update DEFAULT_AGENT_MESSAGES_TEMPLATE constant to match .md file"
      - "Add DEFAULT_SESSION_SUMMARY_TEMPLATE constant"
      - "Add new template to DEFAULT_TEMPLATES dictionary"
    lines_affected: 15

# Integration Points
integration:
  - file: "graphiti_core/session_tracking/prompts.py"
    type: "constant"
    description: "Add DEFAULT_SESSION_SUMMARY_TEMPLATE to module-level constants and DEFAULT_TEMPLATES mapping"

  - file: "graphiti_core/session_tracking/prompt_builder.py"
    type: "reference"
    description: "New session template should align with existing DEFAULT_PROMPT_TEMPLATE structure (already has activity_profile and dynamic fields)"

# Patterns to Follow
patterns:
  - source: "graphiti_core/session_tracking/prompts/default-user-messages.md"
    pattern: "Markdown format with {placeholder} variables and structured sections (Context, Focus on, Original content, Summary)"

  - source: "graphiti_core/session_tracking/prompts.py"
    pattern: "Python triple-quoted strings for templates, dictionary mapping filename to template content"

  - source: "graphiti_core/session_tracking/prompt_builder.py"
    pattern: "Session template structure with activity_profile, dynamic extraction instructions, content, and response format guidance"

# Test Requirements
test_requirements:
  unit:
    - "Verify default-user-messages.md contains '1 paragraph or less' text"
    - "Verify default-agent-messages.md contains '1 paragraph or less' text"
    - "Verify default-session-summary.md exists and contains required placeholders: {activity_profile}, {dynamic_extraction_instructions}, {content}"
    - "Verify prompts.py DEFAULT_TEMPLATES contains all three templates with matching content"
    - "Verify template file content matches prompts.py constants (consistency check)"

  integration:
    - "Verify template loading system can load all three templates successfully"
    - "Verify new session template format aligns with SessionSummarySchema structure"
    - "Verify activity profile placeholder in session template works with prompt_builder.py formatting"

  security:
    - "Verify no credential leakage in template content"
    - "Verify template placeholders are properly escaped"

# Acceptance Criteria Mapping
acceptance_criteria:
  - id: "AC-13.1"
    text: "(P0) default-user-messages.md updated with '1 paragraph or less'"
    implementation: "files_to_modify[0] - default-user-messages.md"
    tests: "test_requirements.unit[0]"

  - id: "AC-13.2"
    text: "(P0) default-agent-messages.md updated with '1 paragraph or less'"
    implementation: "files_to_modify[1] - default-agent-messages.md"
    tests: "test_requirements.unit[1]"

  - id: "AC-13.3"
    text: "(P1) default-session-summary.md created with dynamic extraction placeholder"
    implementation: "files_to_create[0] - default-session-summary.md"
    tests: "test_requirements.unit[2]"

  - id: "AC-13.4"
    text: "(P1) Templates reference activity profile when available"
    implementation: "files_to_create[0] - default-session-summary.md (includes {activity_profile} placeholder)"
    tests: "test_requirements.integration[2]"
