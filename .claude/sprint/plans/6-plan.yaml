# Plan: 6
# Generated by: discovery:6.d
# Timestamp: 2025-12-12T00:00:00Z

story_id: "6"
title: "Clean Up Test Files"
created: "2025-12-12T00:00:00Z"
created_by: "discovery:6.d"

# Analysis Summary
analysis:
  summary: "Remove obsolete tests for deprecated session tracking features (time-based logic, file watcher, periodic checking). Update test files that validate deprecated config parameters."
  complexity: "medium"
  estimated_files: 4
  estimated_tokens: 8000
  risk_factors:
    - "Tests may be relied upon by other test suites"
    - "Need to ensure no test coverage gaps are created"
    - "Config validator tests need careful updates to avoid breaking existing validation"

# Files to Create
files_to_create: []

# Files to Modify
files_to_modify:
  - path: "tests/test_deprecated_config_integration.py"
    changes:
      - "Remove entire file - tests deprecated config parameters that no longer exist"
    lines_affected: 189

  - path: "tests/test_deprecated_config_security.py"
    changes:
      - "Remove entire file - tests security of deprecated parameters that no longer exist"
    lines_affected: 169

  - path: "tests/test_config_validator.py"
    changes:
      - "Remove test_validate_schema_invalid_types test (line 208: inactivity_timeout validation)"
      - "Remove check_interval from valid_fields in test_suggest_field_name (line 308)"
      - "Update related validation tests to not reference deprecated fields"
    lines_affected: 15

  - path: "tests/session_tracking/test_performance.py"
    changes:
      - "Remove entire TestPeriodicCheckerOverhead class (lines 16-50)"
      - "Remove TestFileWatcherScalability class (lines 53-141)"
      - "Keep TestTemplateResolutionCaching and TestSessionDiscoveryPerformance classes"
    lines_affected: 126

  - path: "tests/session_tracking/test_regression.py"
    changes:
      - "Remove TestOriginalFileWatcherFunctionality class (lines 117-183)"
      - "Keep TestOriginalParserFunctionality, TestOriginalFilterFunctionality, TestOriginalIndexerFunctionality"
    lines_affected: 67

# Integration Points
integration:
  - file: "tests/test_config_validator.py"
    type: "test_validation"
    description: "Ensure removal of deprecated field tests doesn't break other validation tests"

  - file: "pytest.ini"
    type: "test_configuration"
    description: "Verify test discovery still works after removing test files"

# Patterns to Follow
patterns:
  - source: "tests/test_session_file_monitoring.py"
    pattern: "File header comment pattern for deprecation notice (lines 1-5)"

  - source: "tests/session_tracking/test_performance.py"
    pattern: "Keep performance tests that are still relevant (template caching, session discovery)"

# Test Requirements
test_requirements:
  unit:
    - "Verify pytest runs successfully after test file removals"
    - "Verify test suite discovers remaining tests correctly"
    - "Verify no import errors from removed test files"

  integration:
    - "Run full test suite to ensure no broken test dependencies"
    - "Verify test coverage metrics are updated correctly"

  security:
    - "Verify config validation still works for non-deprecated fields"
    - "Ensure removal doesn't weaken security test coverage"

# Acceptance Criteria Mapping
acceptance_criteria:
  - id: "AC-6.1"
    text: "(P0) Identify tests in tests/ referencing deprecated params"
    implementation: "files_to_modify[all] - grep analysis complete"
    tests: "test_requirements.unit[0-2]"

  - id: "AC-6.2"
    text: "(P0) Remove tests for check_inactive_sessions_periodically"
    implementation: "files_to_modify[3] - test_performance.py TestPeriodicCheckerOverhead class"
    tests: "test_requirements.integration[0]"

  - id: "AC-6.3"
    text: "(P1) Remove tests for file watcher time-based behavior"
    implementation: "files_to_modify[3,4] - test_performance.py TestFileWatcherScalability, test_regression.py TestOriginalFileWatcherFunctionality"
    tests: "test_requirements.integration[0]"

  - id: "AC-6.4"
    text: "(P1) Update test_config_validator.py to remove deprecated param validation tests"
    implementation: "files_to_modify[2] - test_config_validator.py"
    tests: "test_requirements.security[0-1]"
