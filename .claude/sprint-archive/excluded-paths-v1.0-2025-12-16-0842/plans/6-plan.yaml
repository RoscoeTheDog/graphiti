# Plan: 6
# Generated by: discovery:6.d
# Timestamp: 2025-12-14T19:30:00Z

story_id: "6"
title: "Documentation and Testing"
created: "2025-12-14T19:30:00Z"
created_by: "discovery:6.d"

# Analysis Summary
analysis:
  summary: "Update installation documentation to reflect new venv-based installer workflow and create comprehensive test suite for venv functionality"
  complexity: "medium"
  estimated_files: 6
  estimated_tokens: 18000
  risk_factors:
    - "Documentation accuracy depends on Stories 1-5 implementation being stable"
    - "Test coverage requires understanding existing test infrastructure patterns"
    - "README.md changes may conflict with upstream Graphiti documentation style"

# Files to Create
files_to_create:
  - path: "mcp_server/tests/test_venv_creation.py"
    purpose: "Unit tests for VenvManager.create_venv() and venv detection"
    pattern_source: "mcp_server/tests/test_configuration.py"
    estimated_lines: 150

  - path: "mcp_server/tests/test_package_installation.py"
    purpose: "Unit tests for VenvManager.install_package() with uv/pip fallback"
    pattern_source: "mcp_server/tests/test_configuration.py"
    estimated_lines: 120

  - path: "mcp_server/tests/test_wrapper_generation.py"
    purpose: "Unit tests for CLI wrapper script generation (cross-platform)"
    pattern_source: "mcp_server/tests/test_mcp_integration.py"
    estimated_lines: 180

  - path: "mcp_server/tests/test_full_install_flow.py"
    purpose: "Integration test for full installer.py → CLI availability workflow"
    pattern_source: "mcp_server/tests/test_comprehensive_integration.py"
    estimated_lines: 200

# Files to Modify
files_to_modify:
  - path: "README.md"
    changes:
      - "Replace Installation section with new venv-based workflow (clone → setup → install → enable)"
      - "Add installation step: python mcp_server/daemon/installer.py"
      - "Add PATH configuration instructions (platform-specific)"
      - "Reference TROUBLESHOOTING_DAEMON.md for common issues"
      - "Update prerequisites to mention uv optional (faster venv creation)"
    lines_affected: 80

  - path: "docs/TROUBLESHOOTING_DAEMON.md"
    changes:
      - "Add section: Venv not created (uv/python version issues, permission errors)"
      - "Add section: CLI commands not found after install (PATH not updated, shell not reloaded)"
      - "Add section: Service fails to start (Python path issues in service config, venv detection failure)"
      - "Cross-reference new installation workflow in README.md"
    lines_affected: 60

# Integration Points
integration:
  - file: "mcp_server/tests/conftest.py"
    type: "import"
    description: "Shared test fixtures for venv testing (temp directories, cleanup)"

  - file: "mcp_server/tests/pytest.ini"
    type: "config"
    description: "Test discovery will automatically include new test_*.py files"

  - file: "mcp_server/daemon/venv_manager.py"
    type: "import"
    description: "Import VenvManager class for unit testing"

  - file: "mcp_server/daemon/installer.py"
    type: "import"
    description: "Import installer functions for integration testing"

# Patterns to Follow
patterns:
  - source: "mcp_server/tests/test_configuration.py"
    pattern: "Use pytest fixtures for setup/teardown, test classes for grouping, parametrize for cross-platform testing"

  - source: "mcp_server/tests/test_comprehensive_integration.py"
    pattern: "Integration tests use async/await patterns, comprehensive assertions, cleanup in finally blocks"

  - source: "mcp_server/tests/pytest.ini"
    pattern: "Use pytest markers (unit, integration, slow) for test categorization"

  - source: "docs/TROUBLESHOOTING_DAEMON.md"
    pattern: "Structured troubleshooting: Symptoms → Cause → Solutions with code examples, platform-specific guidance"

  - source: "README.md"
    pattern: "Clear numbered installation steps, code blocks with language hints, platform-specific notes, cross-references to detailed docs"

# Test Requirements
test_requirements:
  unit:
    - "VenvManager.create_venv() creates venv successfully with uv"
    - "VenvManager.create_venv() falls back to python -m venv if uv unavailable"
    - "VenvManager.detect_venv() correctly identifies existing venv"
    - "VenvManager.create_venv() with force=True recreates venv"
    - "VenvManager.create_venv() raises IncompatiblePythonVersionError for Python < 3.10"
    - "VenvManager.create_venv() raises VenvCreationError on subprocess failure"
    - "VenvManager.install_package() installs package successfully with uv"
    - "VenvManager.install_package() falls back to pip if uv unavailable"
    - "VenvManager.install_package() raises error for non-existent venv"
    - "VenvManager.install_package() handles package installation failures gracefully"
    - "CLI wrapper generation creates .bat file on Windows with correct Python path"
    - "CLI wrapper generation creates shell script on Unix with correct Python path"
    - "CLI wrapper generation sets executable permissions on Unix"
    - "CLI wrapper validation checks script content correctness"

  integration:
    - "Full installer.py execution from clean state completes successfully"
    - "Installer creates venv at expected location (~/.graphiti/.venv)"
    - "Installer installs package into venv (graphiti-core available)"
    - "Installer generates CLI wrapper scripts (graphiti-mcp, graphiti-mcp-daemon)"
    - "CLI commands are executable after installer completes"
    - "Installer displays PATH instructions to user (platform-specific)"
    - "Installer handles already-installed scenario gracefully (idempotent)"

  security:
    - "Not applicable (documentation and testing focused)"

# Acceptance Criteria Mapping
acceptance_criteria:
  - id: "AC-6.1"
    text: "(P0) README.md updated with new installation steps"
    implementation: "files_to_modify[0] (README.md)"
    tests: "Manual verification - documentation accuracy"

  - id: "AC-6.2"
    text: "(P0) TROUBLESHOOTING_DAEMON.md updated for venv-related issues"
    implementation: "files_to_modify[1] (docs/TROUBLESHOOTING_DAEMON.md)"
    tests: "Manual verification - troubleshooting completeness"

  - id: "AC-6.3"
    text: "(P1) Unit tests for venv creation and wrapper generation"
    implementation: "files_to_create[0,1,2] (test_venv_creation.py, test_package_installation.py, test_wrapper_generation.py)"
    tests: "test_requirements.unit (14 test cases)"

  - id: "AC-6.4"
    text: "(P1) Integration test for full install → CLI availability flow"
    implementation: "files_to_create[3] (test_full_install_flow.py)"
    tests: "test_requirements.integration (7 test cases)"
