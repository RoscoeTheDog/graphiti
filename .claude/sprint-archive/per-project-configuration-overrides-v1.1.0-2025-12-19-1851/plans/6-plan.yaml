# Plan: 6
# Generated by: discovery:6.d
# Timestamp: 2025-12-18T10:30:00Z

story_id: "6"
title: "Config Validation and Documentation"
created: "2025-12-18T10:30:00Z"
created_by: "discovery:6.d"

# Analysis Summary
analysis:
  summary: "Extend existing config validator to validate project_overrides structure, add warnings for non-overridable sections, bump version to 1.1.0, and update documentation with comprehensive project override examples."
  complexity: "medium"
  estimated_files: 4
  estimated_tokens: 8000
  risk_factors:
    - "Need to maintain backward compatibility with configs lacking project_overrides"
    - "Validator must correctly identify non-overridable sections (database, daemon, resilience)"
    - "Documentation must be clear about override precedence and limitations"

# Files to Create
files_to_create: []

# Files to Modify
files_to_modify:
  - path: "mcp_server/config_validator.py"
    changes:
      - "Add validation method for project_overrides structure"
      - "Add warning detection for non-overridable sections in overrides (database, daemon, resilience)"
      - "Ensure existing validation passes for configs without project_overrides field"
      - "Add semantic validation for project paths in project_overrides dict"
    lines_affected: 50

  - path: "mcp_server/unified_config.py"
    changes:
      - "Update version constant from 1.0.0 to 1.1.0"
      - "Add version field validator to reject configs < 1.0.0 or > 1.1.0"
      - "Update docstrings to reflect version 1.1.0 features"
    lines_affected: 10

  - path: "CONFIGURATION.md"
    changes:
      - "Add new section documenting project_overrides feature"
      - "Include examples showing realistic override scenarios (dev vs prod LLM models)"
      - "Document non-overridable sections with clear explanation"
      - "Add troubleshooting section for common override issues"
      - "Update version references from 1.0.0 to 1.1.0 throughout"
    lines_affected: 150

  - path: "graphiti.config.json"
    changes:
      - "Update version field to 1.1.0"
      - "Add example project_overrides section with realistic example"
      - "Add comments explaining override behavior"
    lines_affected: 20

# Integration Points
integration:
  - file: "mcp_server/config_validator.py"
    type: "validation"
    description: "Integrate new project_overrides validation into existing validate_schema and validate_semantics methods"

  - file: "mcp_server/unified_config.py"
    type: "config"
    description: "Existing _validate_override method already logs warnings for non-overridable sections, ensure validator mirrors this logic"

# Patterns to Follow
patterns:
  - source: "mcp_server/config_validator.py:validate_schema"
    pattern: "Use Pydantic ValidationError catching pattern with path extraction and suggestion generation"

  - source: "mcp_server/config_validator.py:validate_semantics"
    pattern: "Use result.add_warning() for non-blocking issues (like non-overridable sections in overrides)"

  - source: "mcp_server/unified_config.py:_validate_override"
    pattern: "Check for non-overridable sections: version, database, daemon, resilience, project, search, performance"

  - source: "CONFIGURATION.md:Database Configuration section"
    pattern: "Use structured sections with Overview, Options, Examples, Troubleshooting subsections"

# Test Requirements
test_requirements:
  unit:
    - "Validator accepts valid config with project_overrides"
    - "Validator accepts valid config without project_overrides (backward compatibility)"
    - "Validator warns when project_overrides contains database section"
    - "Validator warns when project_overrides contains daemon section"
    - "Validator warns when project_overrides contains resilience section"
    - "Validator warns when project_overrides contains version field"
    - "Validator accepts version 1.1.0 configs"
    - "Validator rejects version 0.9.0 configs (too old)"
    - "Validator rejects version 2.0.0 configs (too new)"

  integration:
    - "Full validation cycle (syntax -> schema -> semantic) with project_overrides"
    - "Config file with project_overrides loads successfully via GraphitiConfig.from_file()"
    - "get_effective_config() uses validated project_overrides correctly"
    - "CLI validator tool reports warnings for non-overridable sections"

  security:
    - "Validator does not expose sensitive data in error messages"
    - "Project paths in project_overrides do not cause directory traversal vulnerabilities"

# Acceptance Criteria Mapping
acceptance_criteria:
  - id: "AC-6.1"
    text: "(P0) Config validator validates `project_overrides` structure"
    implementation: "files_to_modify[0] (config_validator.py - add project_overrides validation)"
    tests: "test_requirements.unit[0,1] + test_requirements.integration[0,1]"

  - id: "AC-6.2"
    text: "(P0) Validator warns on non-overridable sections in overrides"
    implementation: "files_to_modify[0] (config_validator.py - add non-overridable section detection)"
    tests: "test_requirements.unit[2,3,4,5] + test_requirements.integration[3]"

  - id: "AC-6.3"
    text: "(P0) Existing configs without `project_overrides` work unchanged"
    implementation: "files_to_modify[0] (config_validator.py - backward compatibility check)"
    tests: "test_requirements.unit[1] + test_requirements.integration[1]"

  - id: "AC-6.4"
    text: "(P1) Config version bumped to 1.1.0"
    implementation: "files_to_modify[1,3] (unified_config.py, graphiti.config.json - version update)"
    tests: "test_requirements.unit[6,7,8]"

  - id: "AC-6.5"
    text: "(P1) CONFIGURATION.md updated with project_overrides documentation"
    implementation: "files_to_modify[2] (CONFIGURATION.md - new section + examples)"
    tests: "Manual review of documentation clarity and completeness"

  - id: "AC-6.6"
    text: "(P1) Example config in spec includes realistic project overrides"
    implementation: "files_to_modify[3] (graphiti.config.json - add example overrides)"
    tests: "test_requirements.integration[1] (example config loads successfully)"
