# Plan: 3
# Generated by: discovery:3.d
# Timestamp: 2025-12-12T22:30:00Z

story_id: "3"
title: "Remove File Watcher Module"
created: "2025-12-12T22:30:00Z"
created_by: "discovery:3.d"

# Analysis Summary
analysis:
  summary: "Remove deprecated file watcher module and its integration points. The SessionFileWatcher uses watchdog library to monitor filesystem changes, but is superseded by turn-based processing where each conversation turn is indexed immediately."
  complexity: "low"
  estimated_files: 6
  estimated_tokens: 800
  risk_factors:
    - "SessionManager depends heavily on watcher - need to remove that dependency"
    - "Test file uses watcher fixtures - needs cleanup"
    - "Watchdog dependency in pyproject.toml may still be used elsewhere"

# Files to Create
files_to_create: []

# Files to Modify
files_to_modify:
  - path: "graphiti_core/session_tracking/__init__.py"
    changes:
      - "Remove import statement for SessionFileWatcher and SessionFileEventHandler (line 72)"
      - "Remove 'SessionFileWatcher' and 'SessionFileEventHandler' from __all__ list (lines 137-138)"
    lines_affected: 4

  - path: "graphiti_core/session_tracking/session_manager.py"
    changes:
      - "Remove import of SessionFileWatcher (line 22)"
      - "Remove watcher initialization in __init__ (lines 82-88)"
      - "Remove watcher.start() call in start() method (line 104)"
      - "Remove watcher.stop() call in stop() method (line 124)"
      - "Remove _discover_existing_sessions method (keep_length_days logic no longer needed)"
      - "Remove time-based file watching callbacks: _handle_session_created, _handle_session_modified, _handle_session_deleted"
      - "Simplify SessionManager to basic session registry without filesystem monitoring"
    lines_affected: 200

  - path: "tests/test_session_file_monitoring.py"
    changes:
      - "Remove tests that use SessionFileWatcher"
      - "Update tests to use direct SessionManager calls without file watcher"
      - "Remove imports of SessionFileWatcher"
    lines_affected: 50

  - path: "pyproject.toml"
    changes:
      - "Check if watchdog is used elsewhere before removing"
      - "If only used for watcher.py, remove watchdog>=6.0.0 dependency"
    lines_affected: 1

# Files to Delete
files_to_delete:
  - path: "graphiti_core/session_tracking/watcher.py"
    reason: "Entire module is deprecated, superseded by turn-based processing"

# Integration Points
integration:
  - file: "graphiti_core/session_tracking/session_manager.py"
    type: "removal"
    description: "Remove SessionFileWatcher integration from SessionManager, convert to simpler session registry"

  - file: "graphiti_core/session_tracking/__init__.py"
    type: "export"
    description: "Remove SessionFileWatcher and SessionFileEventHandler exports"

# Patterns to Follow
patterns:
  - source: "graphiti_core/session_tracking/session_manager.py"
    pattern: "Story 2 removed time-based logic - follow similar pattern for removing watcher integration"

# Test Requirements
test_requirements:
  unit:
    - "Verify SessionFileWatcher import removed from __init__.py"
    - "Verify SessionFileWatcher not imported in session_manager.py"
    - "Verify SessionManager can be instantiated without watcher"
    - "Verify session registry still functions for basic operations"

  integration:
    - "Verify test_session_file_monitoring.py no longer references watcher"
    - "Verify existing session tracking functionality works without watcher"
    - "Run full test suite to ensure no regressions"

  security:
    - "N/A - no security implications for removing deprecated module"

# Acceptance Criteria Mapping
acceptance_criteria:
  - id: "AC-3.1"
    text: "(P0) Remove watcher.py from graphiti_core/session_tracking/"
    implementation: "files_to_delete[0]"
    tests: "test_requirements.unit[0]"

  - id: "AC-3.2"
    text: "(P0) Remove watcher imports from __init__.py"
    implementation: "files_to_modify[0]"
    tests: "test_requirements.unit[1]"

  - id: "AC-3.3"
    text: "(P1) Remove watcher initialization from session_manager.py"
    implementation: "files_to_modify[1]"
    tests: "test_requirements.unit[2]"

  - id: "AC-3.4"
    text: "(P1) Update tests referencing the watcher"
    implementation: "files_to_modify[2]"
    tests: "test_requirements.integration[0]"

# Dependencies Check
dependencies:
  watchdog_usage:
    status: "to_verify"
    action: "Search for other uses of watchdog library before removing from pyproject.toml"
    command: "grep -r 'from watchdog' --include='*.py' --exclude-dir=tests"

# Implementation Notes
notes:
  - "Story 2 already removed time-based session tracking logic"
  - "Watcher was the mechanism for detecting session file changes over time"
  - "Turn-based processing indexes immediately on each turn, eliminating need for file watching"
  - "SessionManager may need refactoring to be simpler without watcher integration"
  - "Test files may have significant changes needed to remove watcher fixtures"
