# Story 2.1: Fix Test Coverage Gap - inactivity_timeout References

**Parent**: Story 2
**Type**: Remediation
**Issue**: test_coverage_gap - Tests reference removed `inactivity_timeout` parameter
**Created**: 2025-12-12
**Created By**: Validation Story -2.i
**Priority**: P0

## Analysis

**Missing Implementation**: Test files still reference the `inactivity_timeout` parameter that was removed from `SessionManager.__init__` in Story 2.

**Codebase Context**:
- Implementation file: `graphiti_core/session_tracking/session_manager.py` (modified in Story 2)
- Test files with stale references:
  - `tests/session_tracking/test_performance.py` (lines 96, 108, 143)
  - `tests/session_tracking/test_regression.py` (line 175)
  - `tests/session_tracking/test_security.py` (lines 51, 55, 164, 204, 270, 309)

**Integration Points**:
- `SessionManager.__init__` signature changed (no longer accepts `inactivity_timeout`)
- Turn-based architecture eliminates need for time-based session tracking
- Tests need to be updated to reflect new architecture

## Remediation Actions

### 1. Update test_performance.py

Remove `inactivity_timeout` parameter from SessionManager instantiations:

**Lines 96, 108, 143**:
```python
# OLD (REMOVE)
manager = SessionManager(
    path_resolver=path_resolver,
    on_session_closed=callback,
    inactivity_timeout=300,  # <-- REMOVE THIS LINE
)

# NEW
manager = SessionManager(
    path_resolver=path_resolver,
    on_session_closed=callback,
)
```

### 2. Update test_regression.py

Remove config reference to inactivity_timeout:

**Line 175**:
```python
# OLD (REMOVE)
mock_config.session_tracking.inactivity_timeout = 300

# NEW - Remove this line entirely
# Turn-based architecture doesn't use inactivity timeout
```

### 3. Update test_security.py

Remove or replace tests that validate inactivity_timeout behavior:

**Lines 51-55** (test_default_inactivity_timeout_safe):
```python
# OLD (REMOVE ENTIRE TEST)
def test_default_inactivity_timeout_safe(self):
    """Test default inactivity timeout is safe (â‰¥15 min)."""
    config = SessionTrackingConfig()
    assert config.inactivity_timeout == 900, "Default timeout should be 900s (15 min)"

# NEW - Replace with test for turn-based behavior
def test_turn_based_architecture(self):
    """Test that SessionManager uses turn-based processing (no timeout)."""
    path_resolver = ClaudePathResolver()
    manager = SessionManager(path_resolver=path_resolver)
    # Verify no timeout attribute exists
    assert not hasattr(manager, 'inactivity_timeout')
```

**Lines 164, 204, 270, 309**:
```python
# OLD (REMOVE inactivity_timeout parameter)
manager = SessionManager(
    path_resolver=path_resolver,
    on_session_closed=callback,
    inactivity_timeout=300,  # <-- REMOVE THIS LINE
)

# NEW
manager = SessionManager(
    path_resolver=path_resolver,
    on_session_closed=callback,
)
```

### 4. Verify SessionTrackingConfig

Check if `SessionTrackingConfig` class still has `inactivity_timeout` field:

**File**: Search for `SessionTrackingConfig` definition
```bash
grep -rn "class SessionTrackingConfig" graphiti_core/
```

If found, remove `inactivity_timeout` field from config schema.

### 5. Run Tests

After making changes, verify all tests pass:

```bash
pytest tests/session_tracking/test_performance.py -v
pytest tests/session_tracking/test_regression.py -v
pytest tests/session_tracking/test_security.py -v
```

Expected:
- All tests pass
- No references to `inactivity_timeout` remain
- Tests validate turn-based session processing

## Acceptance Criteria

- [ ] **(P0)** Remove `inactivity_timeout` parameter from all SessionManager instantiations in test files
- [ ] **(P0)** Update or remove `test_default_inactivity_timeout_safe` test in test_security.py
- [ ] **(P0)** Remove config reference to `inactivity_timeout` in test_regression.py
- [ ] **(P1)** Add test to verify SessionManager doesn't have timeout attribute (turn-based validation)
- [ ] **(P0)** All affected tests pass with 100% pass rate

## Verification

Re-run validation Check I for Story 2 to verify:
1. Test files no longer reference removed functionality
2. All tests pass (100% P0 criteria)
3. Tests validate turn-based architecture behavior

## Implementation Notes

**Scope**: Test cleanup only - no production code changes
**Risk**: Low - fixes test failures caused by Story 2 implementation
**Dependencies**: Requires Story 2 to be completed (already done)
